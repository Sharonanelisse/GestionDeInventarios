<!DOCTYPE html>
<html
        xmlns="http://www.w3.org/1999/xhtml"
        xmlns:h="http://xmlns.jcp.org/jsf/html"
        xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
        xmlns:f="http://xmlns.jcp.org/jsf/core"
        xmlns:p="http://primefaces.org/ui"
>
<ui:composition template="/WEB-INF/templates/layout.xhtml">
    <ui:define name="content">
        <div class="card">
            <h2>Movimientos de Stock</h2>
            <h:form id="formMovimiento">
                <h3>Registrar Movimiento</h3>
                <p:messages id="msgs" closable="true" />
                <p:panelGrid columns="2" style="margin-bottom:1rem">
                    <p:outputLabel value="Producto" for="producto" />
                    <p:selectOneMenu id="producto" value="#{movimientoController.movimiento.producto}" required="true">
                        <f:selectItems value="#{movimientoController.productos}" var="prod" itemValue="#{prod}" itemLabel="#{prod.nombre}" />
                    </p:selectOneMenu>

                    <p:outputLabel value="Tipo" for="tipo" />
                    <p:selectOneMenu id="tipo" value="#{movimientoController.movimiento.tipo}" required="true">
                        <f:selectItems value="#{movimientoController.tipos}" var="t" itemValue="#{t}" itemLabel="#{t}" />
                    </p:selectOneMenu>

                    <p:outputLabel value="Cantidad" for="cantidad" />
                    <p:inputText id="cantidad" value="#{movimientoController.movimiento.cantidad}" required="true" />

                    <p:outputLabel value="Fecha" for="fecha" />
                    <p:calendar id="fecha" value="#{movimientoController.movimiento.fecha}" required="true" pattern="yyyy-MM-dd" />

                    <p:outputLabel value="Motivo" for="motivo" />
                    <p:inputText id="motivo" value="#{movimientoController.movimiento.motivo}" required="true" />
                </p:panelGrid>
                <p:commandButton value="Registrar" actionListener="#{movimientoController.registrar}" update="msgs table stockActual" icon="pi pi-check" />
                <h:outputText id="stockActual" value="Stock actual: #{movimientoController.stockActual}" style="margin-left:1rem; font-weight:bold;" />
            </h:form>

            <h:form id="formFiltro">
                <h3>Filtrar Movimientos</h3>
                <p:panelGrid columns="4" style="margin-bottom:1rem">
                    <p:outputLabel value="Producto" for="filtroProducto" />
                    <p:selectOneMenu id="filtroProducto" value="#{movimientoController.filtroProducto}">
                        <f:selectItems value="#{movimientoController.productos}" var="prod" itemValue="#{prod.id}" itemLabel="#{prod.nombre}" />
                    </p:selectOneMenu>

                    <p:outputLabel value="Tipo" for="filtroTipo" />
                    <p:selectOneMenu id="filtroTipo" value="#{movimientoController.filtroTipo}">
                        <f:selectItems value="#{movimientoController.tipos}" var="t" itemValue="#{t}" itemLabel="#{t}" />
                    </p:selectOneMenu>

                    <p:outputLabel value="Desde" for="filtroDesde" />
                    <p:calendar id="filtroDesde" value="#{movimientoController.filtroDesde}" pattern="yyyy-MM-dd" />

                    <p:outputLabel value="Hasta" for="filtroHasta" />
                    <p:calendar id="filtroHasta" value="#{movimientoController.filtroHasta}" pattern="yyyy-MM-dd" />
                </p:panelGrid>
                <p:commandButton value="Filtrar" actionListener="#{movimientoController.filtrar}" update="table" icon="pi pi-filter" />
            </h:form>

            <h:form id="formTabla">
                <p:dataTable
                        id="table"
                        value="#{movimientoController.movimientos}"
                        var="m"
                        paginator="true"
                        rows="10"
                        responsiveLayout="scroll"
                        styleClass="p-datatable-striped p-datatable-gridlines"
                >
                    <p:column headerText="ID" width="80">#{m.id}</p:column>
                    <p:column headerText="Producto">#{m.producto.nombre}</p:column>
                    <p:column headerText="Tipo">#{m.tipo}</p:column>
                    <p:column headerText="Cantidad">#{m.cantidad}</p:column>
                    <p:column headerText="Fecha">#{m.fecha}</p:column>
                    <p:column headerText="Motivo">#{m.motivo}</p:column>
                    <p:column headerText="Stock Actual">#{m.producto.stockActual}</p:column>
                </p:dataTable>
            </h:form>
        </div>
    </ui:define>
</ui:composition>
</html>